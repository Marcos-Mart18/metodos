<div class="max-w-6xl mx-auto p-4 sm:p-6 space-y-6">
    <header class="flex flex-col sm:flex-row sm:items-end sm:justify-between gap-3">
      <div>
        <h1 class="text-2xl font-bold">Interpolación — Diferencias Divididas de Newton</h1>
        <p class="text-sm text-gray-500">Ingresa puntos por tabla o por listas de texto.</p>
      </div>
  
      <div class="inline-flex rounded-2xl bg-gray-100 p-1">
        <button
          class="px-4 py-2 rounded-xl text-sm transition"
          [class.bg-white]="mode==='tabla'"
          [class.shadow]="mode==='tabla'"
          (click)="mode='tabla'">
          En tablita
        </button>
        <button
          class="px-4 py-2 rounded-xl text-sm transition"
          [class.bg-white]="mode==='texto'"
          [class.shadow]="mode==='texto'"
          (click)="mode='texto'">
          Por puntos (texto)
        </button>
      </div>
    </header>
  
    <!-- Entrada por tabla -->
    <section *ngIf="mode==='tabla'" class="bg-white rounded-2xl shadow p-4 sm:p-6 space-y-4">
      <div class="flex items-center justify-between">
        <h2 class="font-semibold text-lg">Datos en tabla</h2>
        <button type="button"
                class="px-3 py-1.5 rounded-lg text-sm bg-blue-600 text-white hover:bg-blue-700"
                (click)="addRow()">
          + Añadir fila
        </button>
      </div>
  
      <div class="overflow-x-auto">
        <table class="min-w-full border-separate border-spacing-y-2">
          <thead>
            <tr class="text-left text-gray-600">
              <th class="px-3 py-2">#</th>
              <th class="px-3 py-2">x</th>
              <th class="px-3 py-2">y</th>
              <th class="px-3 py-2"></th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let r of points; let i = index" class="bg-gray-50">
              <td class="px-3 py-2 font-medium text-gray-500">{{ i }}</td>
              <td class="px-3 py-2">
                <input type="number" step="any" [(ngModel)]="r.x"
                       class="w-40 sm:w-48 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"/>
              </td>
              <td class="px-3 py-2">
                <input type="number" step="any" [(ngModel)]="r.y"
                       class="w-40 sm:w-48 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"/>
              </td>
              <td class="px-3 py-2">
                <button type="button"
                        class="px-3 py-1.5 rounded-lg text-sm bg-rose-500 text-white hover:bg-rose-600 disabled:opacity-40"
                        (click)="removeRow(i)" [disabled]="points.length <= 2">
                  Quitar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </section>
  
    <!-- Entrada por texto -->
    <section *ngIf="mode==='texto'" class="bg-white rounded-2xl shadow p-4 sm:p-6 space-y-4">
      <h2 class="font-semibold text-lg">Datos por puntos (texto)</h2>
      <div class="grid sm:grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">X (coma/espacio)</label>
          <textarea [(ngModel)]="xText" rows="4"
                    class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"
                    placeholder="Ej: 0, 1, 2, 3"></textarea>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Y (coma/espacio)</label>
          <textarea [(ngModel)]="yText" rows="4"
                    class="w-full rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"
                    placeholder="Ej: 1, 3, 5, 7"></textarea>
        </div>
      </div>
      <p class="text-xs text-gray-500">Tip: también acepta punto y coma o saltos de línea.</p>
    </section>
  
    <!-- Acciones -->
    <section class="bg-white rounded-2xl shadow p-4 sm:p-6 space-y-4">
      <div class="flex flex-col sm:flex-row gap-3 sm:items-center sm:justify-between">
        <div class="flex items-center gap-3">
          <button type="button"
                  class="px-4 py-2 rounded-xl bg-blue-600 text-white hover:bg-blue-700"
                  (click)="calculate()">
            Calcular
          </button>
          <button type="button"
                  class="px-4 py-2 rounded-xl bg-gray-200 hover:bg-gray-300"
                  (click)="clear()">
            Limpiar
          </button>
        </div>
  
        <div class="flex items-center gap-2">
          <label class="text-sm text-gray-600">Decimales:</label>
          <input type="number" min="0" max="10" [(ngModel)]="decimals"
                 class="w-20 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"/>
        </div>
      </div>
  
      <p *ngIf="error" class="p-3 rounded-lg bg-rose-50 text-rose-700 text-sm border border-rose-200">
        {{ error }}
      </p>
  
      <!-- Resultados -->
      <div *ngIf="calculado" class="space-y-6">
        <!-- Forma de Newton -->
        <div class="p-4 bg-gray-50 rounded-xl space-y-1">
          <div class="text-sm text-gray-500">Polinomio en forma de Newton:</div>
          <div class="font-mono break-words">P(x) = {{ newtonString }}</div>
        </div>
  
        <!-- Tabla de diferencias divididas -->
        <div class="p-4 bg-gray-50 rounded-xl">
          <h3 class="font-semibold mb-3">Tabla de diferencias divididas</h3>
          <div class="overflow-x-auto">
            <table class="min-w-full text-sm">
              <thead>
                <tr class="text-left text-gray-600">
                  <th class="px-3 py-2">i</th>
                  <th class="px-3 py-2">x<sub>i</sub></th>
                  <th class="px-3 py-2">f[x<sub>i</sub>]</th>
                  <th class="px-3 py-2" *ngFor="let _ of xs; let j = index" [hidden]="j===0">
                    Orden {{ j }}
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let xi of xs; let i = index" class="bg-white">
                  <td class="px-3 py-2 text-gray-500">{{ i }}</td>
                  <td class="px-3 py-2 font-mono">{{ formatNum(xi) }}</td>
                  <ng-container *ngFor="let _ of xs; let j = index">
                    <td class="px-3 py-2 font-mono"
                        *ngIf="j === 0"
                    >
                      {{ formatNum(ddTable[i][0]) }}
                    </td>
                    <td class="px-3 py-2 font-mono"
                        *ngIf="j > 0"
                    >
                      <span *ngIf="i <= xs.length - 1 - j; else empty">
                        {{ formatNum(ddTable[i][j]) }}
                      </span>
                      <ng-template #empty>&nbsp;</ng-template>
                    </td>
                  </ng-container>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
  
        <!-- Coeficientes a_k de Newton y evaluación -->
        <div class="grid lg:grid-cols-2 gap-4">
          <div class="p-4 bg-gray-50 rounded-xl">
            <h3 class="font-semibold mb-2">Coeficientes de Newton (a<sub>k</sub>)</h3>
            <ul class="space-y-1 font-mono text-sm">
              <li *ngFor="let a of newtonCoeffs; let k = index">
                a{{k}} = {{ formatNum(a) }}
              </li>
            </ul>
          </div>
  
          <div class="p-4 bg-gray-50 rounded-xl">
            <h3 class="font-semibold mb-2">Evaluar P(t)</h3>
            <div class="flex items-center gap-2">
              <label class="text-sm">t:</label>
              <input type="number" step="any" [(ngModel)]="tEval" (ngModelChange)="evaluate()"
                     class="w-40 rounded-lg border-gray-300 focus:border-blue-500 focus:ring-blue-500"/>
            </div>
            <div class="mt-2 text-sm" *ngIf="pEval !== null">
              P(t) = <span class="font-mono">{{ formatNum(pEval!) }}</span>
            </div>
          </div>
        </div>
  
        <!-- Forma estándar (expandida) -->
        <div class="p-4 bg-gray-50 rounded-xl space-y-2">
          <h3 class="font-semibold">Polinomio en forma estándar</h3>
          <div class="font-mono break-words">P(x) = {{ polyStdString }}</div>
          <div class="text-sm text-gray-600">Grado: {{ degree }}</div>
          <div>
            <h4 class="font-semibold mt-2 mb-1">Coeficientes estándar (a<sub>k</sub>)</h4>
            <ul class="space-y-1 font-mono text-sm">
              <li *ngFor="let c of coeffsStd; let k = index">
                a{{k}} = {{ formatNum(c) }}
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </div>
  