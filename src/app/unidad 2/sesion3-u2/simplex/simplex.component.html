<div class="p-6 min-h-screen flex flex-col items-center bg-gray-50">
  <div
    class="w-full max-w-5xl bg-white rounded-2xl shadow-lg border border-gray-200 p-6"
  >
    <!-- Volver -->
    <a
      routerLink="/sesion7"
      class="inline-flex items-center gap-2 bg-gradient-to-b from-[#001C48] to-[#003366] text-white font-bold text-sm px-4 py-2 rounded-lg shadow-md hover:shadow-lg hover:-translate-y-0.5 transition mb-6"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="w-5 h-5"
        viewBox="0 0 24 24"
        fill="currentColor"
      >
        <path
          d="M19 11H7.14l3.63-4.36a1 1 0 1 0-1.54-1.28l-5 6a1 1 0 0 0 0 1.28l5 6A1 1 0 0 0 10 19a1 1 0 0 0 .77-1.64L7.14 13H19a1 1 0 0 0 0-2z"
        />
      </svg>
      <span>Volver</span>
    </a>

    <!-- Título -->
    <h1 class="text-3xl font-bold text-[#001C48] mb-2 text-center">
      Método Simplex
    </h1>
    <p class="text-center text-gray-600 mb-6">
      Ingresa variables, restricciones, función objetivo y visualiza cada
      iteración con selección de pivote.
    </p>

    <!-- Controles superiores -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
      <div>
        <label
          for="numVariables"
          class="block text-sm font-medium text-[#001C48]"
          >Número de Variables</label
        >
        <input
          type="number"
          id="numVariables"
          [(ngModel)]="numVariables"
          (change)="updateDimensions()"
          class="w-full p-3 rounded-lg bg-gray-100 border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA]"
          min="1"
        />
      </div>

      <div>
        <label
          for="numConstraints"
          class="block text-sm font-medium text-[#001C48]"
          >Número de Restricciones</label
        >
        <input
          type="number"
          id="numConstraints"
          [(ngModel)]="numConstraints"
          (change)="updateDimensions()"
          class="w-full p-3 rounded-lg bg-gray-100 border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA]"
          min="1"
        />
      </div>

      <div>
        <label class="block text-sm font-medium text-[#001C48]"
          >Precisión (dígitos)</label
        >
        <input
          type="number"
          [(ngModel)]="precision"
          class="w-full p-3 rounded-lg bg-gray-100 border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA]"
          min="2"
          max="9"
        />
        <p class="text-xs text-gray-500 mt-1">
          Estilo calculadora científica (toPrecision).
        </p>
      </div>
    </div>

    <!-- Función Objetivo -->
    <h3 class="text-2xl font-semibold mb-3 text-[#001C48]">Función Objetivo</h3>
    <div class="mb-6">
      <label class="block text-lg font-medium text-[#001C48]"
        >Maximizar Z =</label
      >
      <div class="flex flex-wrap items-center gap-2 mt-2">
        <span
          *ngFor="let coef of objectiveFunction; let i = index; trackBy: trackByIndex"
          class="flex items-center gap-1"
        >
          <input
            type="number"
            name="objective-{{ i }}"
            id="objective-{{ i }}"
            [(ngModel)]="objectiveFunction[i]"
            class="p-2 border border-gray-300 rounded-md w-24 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
          <span class="text-lg">x{{ i + 1 }}</span>
          <span *ngIf="i < objectiveFunction.length - 1" class="text-lg"
            >+</span
          >
        </span>
      </div>
    </div>

    <!-- Restricciones -->
    <h3 class="text-2xl font-semibold mb-3 text-[#001C48]">Sujeto a</h3>
    <div class="space-y-4">
      <div
        *ngFor="let constraint of constraints; let i = index; trackBy: trackByIndex"
        class="border rounded-xl p-4 bg-gray-50"
      >
        <label class="block text-lg font-medium text-[#001C48] mb-2"
          >Restricción {{ i + 1 }}</label
        >
        <div class="flex flex-wrap items-center gap-2">
          <span
            *ngFor="let coef of constraint.coefficients; let j = index; trackBy: trackByIndex"
            class="flex items-center gap-1"
          >
            <input
              type="number"
              name="coef-{{ i }}-{{ j }}"
              id="coef-{{ i }}-{{ j }}"
              [(ngModel)]="constraint.coefficients[j]"
              class="p-2 border border-gray-300 rounded-md w-24 focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <span class="text-lg">x{{ j + 1 }}</span>
            <span *ngIf="j < constraint.coefficients.length - 1" class="text-lg"
              >+</span
            >
          </span>

          <select
            name="type-{{ i }}"
            id="type-{{ i }}"
            [(ngModel)]="constraint.type"
            class="p-2 border border-gray-300 rounded-md w-24 focus:outline-none focus:ring-2 focus:ring-blue-500"
          >
            <option value="<=">&le;</option>
            <option value=">=">&ge;</option>
            <option value="=">=</option>
          </select>

          <input
            type="number"
            name="rhs-{{ i }}"
            id="rhs-{{ i }}"
            [(ngModel)]="constraint.rhs"
            class="p-2 border border-gray-300 rounded-md w-28 focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="flex flex-wrap items-center justify-center gap-3 mt-6">
      <button
        (click)="loadExample()"
        class="inline-flex items-center gap-2 bg-white text-[#003366] border border-[#003366] font-semibold text-sm px-5 py-2 rounded-lg hover:bg-[#f5f9ff] transition"
      >
        Ejemplo rápido
      </button>

      <button
        (click)="reset()"
        class="inline-flex items-center gap-2 bg-gray-200 text-gray-800 font-semibold text-sm px-5 py-2 rounded-lg hover:bg-gray-300 transition"
      >
        Reiniciar
      </button>

      <button
        (click)="solveSimplex()"
        class="inline-flex items-center gap-2 bg-gradient-to-b from-[#001C48] to-[#003366] text-white font-bold text-sm px-6 py-3 rounded-lg shadow-md hover:shadow-lg hover:-translate-y-0.5 transition"
      >
        Resolver
      </button>
    </div>

    <!-- Resumen del problema -->
    <div class="mt-8">
      <h3 class="text-xl font-semibold text-[#001C48] mb-2">
        Resumen del Modelo
      </h3>
      <div class="rounded-xl border bg-white p-4 text-sm text-[#001C48]">
        <p class="mb-1">
          <span class="font-semibold">Z =</span> {{ prettyObjective() }}
        </p>
        <p class="mb-2"><span class="font-semibold">Sujeto a:</span></p>
        <ul class="list-disc pl-6 space-y-1">
          <li *ngFor="let c of constraints; let i = index">
            {{ prettyConstraint(i) }}
          </li>
        </ul>
        <p class="mt-2 text-xs text-amber-600" *ngIf="hasUnsupportedTypes">
          ⚠️ Las restricciones de tipo "=" no están soportadas. Usa &le; o &ge;.
        </p>
      </div>
    </div>

    <!-- Pasos de solución -->
    <h3 class="text-2xl font-semibold mt-8 mb-4 text-[#001C48]">
      Pasos de Solución
    </h3>

    <div *ngIf="solutionSteps.length === 0" class="text-gray-500 text-sm">
      Los pasos aparecerán aquí después de presionar
      <span class="font-semibold">Resolver</span>.
    </div>

    <div
      *ngFor="let step of solutionSteps"
      class="mb-6 rounded-2xl border shadow-sm overflow-hidden"
    >
      <div
        class="flex flex-wrap items-center justify-between gap-3 bg-gray-100 px-4 py-3 border-b"
      >
        <div class="flex items-center gap-3">
          <span class="text-lg font-bold text-[#001C48]"
            >Iteración {{ step.iteration }}</span
          >
          <span
            class="px-2 py-1 text-xs rounded-full"
            [ngClass]="{
              'bg-green-100 text-green-800': step.enteringVar,
              'bg-gray-100 text-gray-600': !step.enteringVar
            }"
          >
            {{
              step.enteringVar
                ? "Entra: " + step.enteringVar
                : "Óptimo alcanzado"
            }}
          </span>
          <span
            *ngIf="step.leavingVar"
            class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-800"
          >
            Sale: {{ step.leavingVar }}
          </span>
          <span
            *ngIf="step.note"
            class="px-2 py-1 text-xs rounded-full bg-amber-100 text-amber-800"
          >
            {{ step.note }}
          </span>
        </div>
        <div class="text-sm text-[#001C48]">
          <span class="font-semibold">Z =</span> {{ fmt(step.z) }}
        </div>
      </div>

      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left text-[#001C48] min-w-[720px]">
          <thead class="text-xs bg-gray-50 border-b border-gray-300">
            <tr>
              <th class="px-3 py-2 sticky left-0 bg-gray-50 border-r">Fila</th>
              <th
                *ngFor="let h of step.headers; let j = index"
                class="px-3 py-2 text-center border-r"
                [ngClass]="{ 'bg-yellow-50': step.enteringCol === j }"
              >
                {{ h }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let row of step.tableau; let i = index"
              class="border-b"
            >
              <td class="px-3 py-2 sticky left-0 bg-white border-r">
                {{ i < step.tableau.length - 1 ? "R" + (i + 1) : "Z" }}
              </td>
              <td
                *ngFor="let value of row; let j = index"
                class="px-3 py-2 text-center border-r"
                [ngClass]="{
                  'bg-blue-50':
                    step.leavingRow === i && i < step.tableau.length - 1,
                  'bg-green-200 font-semibold':
                    step.leavingRow === i && step.enteringCol === j
                }"
              >
                {{ fmt(value) }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Razón mínima -->
      <div
        *ngIf="step.ratios?.length"
        class="px-4 py-3 bg-white text-sm text-[#001C48]"
      >
        <div class="font-semibold mb-1">
          Prueba de razón mínima (RHS / a<sub>pivot</sub>):
        </div>
        <div class="flex flex-wrap gap-2">
          <span
            *ngFor="let r of step.ratios; let i = index"
            class="px-2 py-1 rounded border"
            [ngClass]="{ 'bg-blue-50 border-blue-300': i === step.leavingRow }"
          >
            R{{ i + 1 }}: {{ r === null ? "—" : fmt(r) }}
          </span>
        </div>
      </div>
    </div>

    <!-- Solución óptima -->
    <h3 class="text-2xl font-semibold mt-8 mb-3 text-[#001C48]">
      Solución Óptima
    </h3>
    <div *ngIf="optimalSolution">
      <div *ngIf="optimalSolution.error" class="text-red-600 text-base">
        {{ optimalSolution.error }}
      </div>

      <div
        *ngIf="!optimalSolution.error"
        class="rounded-xl border bg-white p-4"
      >
        <p class="text-lg font-medium">
          Valor Óptimo:
          <span class="font-bold text-green-700">{{
            fmt(optimalSolution.optimalValue)
          }}</span>
        </p>
        <p class="text-lg font-medium mt-3">Variables:</p>
        <ul class="list-disc pl-6">
          <li *ngFor="let key of objectKeys(optimalSolution.variables)">
            {{ key }} = {{ fmt(optimalSolution.variables[key]) }}
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
