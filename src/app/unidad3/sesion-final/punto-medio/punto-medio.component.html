<div class="p-6 min-h-screen flex flex-col items-center">
  <!-- Volver -->
  <a
    routerLink="/sesion10"
    class="self-start inline-flex items-center gap-2 bg-gradient-to-b from-[#001C48] to-[#003366] text-white font-bold text-sm px-4 py-2 rounded-lg shadow-md hover:shadow-lg hover:from-[#003366] hover:to-[#004080] hover:-translate-y-0.5 transition mb-6"
    aria-label="Volver"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      class="w-5 h-5"
      viewBox="0 0 24 24"
      fill="currentColor"
      aria-hidden="true"
    >
      <path
        d="M19 11H7.14l3.63-4.36a1 1 0 1 0-1.54-1.28l-5 6a1 1 0 0 0 0 1.28l5 6A1 1 0 0 0 10 19a1 1 0 0 0 .64-.23 1 1 0 0 0 .13-1.41L7.14 13H19a1 1 0 0 0 0-2z"
      />
    </svg>
    <span>Volver</span>
  </a>

  <div
    class="w-full max-w-6xl bg-white rounded-2xl shadow-lg border border-gray-200 p-6 space-y-6"
  >
    <header class="flex items-center justify-between flex-wrap gap-3">
      <h2 class="text-2xl font-bold text-[#001C48]">
        Método de Runge-Kutta (Punto Medio)
      </h2>
      <div class="flex items-center gap-2 text-xs text-gray-500">
        <span
          class="inline-flex items-center gap-1 px-2 py-1 rounded bg-gray-100"
          >Decimales:</span
        >
        <input
          [(ngModel)]="decimales"
          type="number"
          min="0"
          max="15"
          class="w-20 p-2 rounded bg-gray-100 text-[#001C48] border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA] focus:outline-none"
        />
      </div>
    </header>

    <p class="text-sm text-gray-600">
      Método numérico de segundo orden para resolver ecuaciones diferenciales
      ordinarias de la forma
      <span class="font-semibold">dy/dx = f(x, y)</span> con condición inicial
      y(x₀) = y₀. Fórmula: y<sub>i+1</sub> = y<sub>i</sub> + k<sub>2</sub>·h,
      donde k<sub>1</sub> = f(x<sub>i</sub>, y<sub>i</sub>) y k<sub>2</sub> =
      f(x<sub>i</sub> + h/2, y<sub>i</sub> + k<sub>1</sub>·h/2).
    </p>

    <!-- Formulario -->
    <section class="grid grid-cols-1 lg:grid-cols-3 gap-5">
      <!-- Ecuación -->
      <div class="lg:col-span-2">
        <label class="block text-sm font-medium text-[#001C48] mb-1"
          >Ecuación dy/dx = f(x, y)</label
        >
        <input
          [(ngModel)]="ecuacion"
          class="w-full p-3 rounded bg-gray-100 text-[#001C48] border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA] focus:outline-none"
          type="text"
          placeholder="Ej: x + y"
          aria-label="Ecuación dy/dx = f(x, y)"
        />
        <div class="mt-2 grid grid-cols-8 sm:grid-cols-10 gap-2 text-sm">
          <button
            (click)="insertar('^')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            ^
          </button>
          <button
            (click)="insertar('sqrt()')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            √
          </button>
          <button
            (click)="insertar('pi')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            π
          </button>
          <button
            (click)="insertar('sin()')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            sin
          </button>
          <button
            (click)="insertar('cos()')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            cos
          </button>
          <button
            (click)="insertar('tan()')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            tan
          </button>
          <button
            (click)="insertar('exp()')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            exp
          </button>
          <button
            (click)="insertar('ln()')"
            type="button"
            class="p-2 bg-gray-200 rounded hover:bg-gray-300"
          >
            ln
          </button>
          <button
            (click)="cargarEjemplo1()"
            type="button"
            class="p-2 bg-blue-50 text-[#003366] border border-[#003366]/20 rounded hover:bg-blue-100"
          >
            Ejemplo 1
          </button>
          <button
            (click)="cargarEjemplo2()"
            type="button"
            class="p-2 bg-blue-50 text-[#003366] border border-[#003366]/20 rounded hover:bg-blue-100"
          >
            Ejemplo 2
          </button>
        </div>
        <p *ngIf="mensajeError" class="mt-2 text-sm text-red-600">
          {{ mensajeError }}
        </p>
      </div>

      <!-- Parámetros -->
      <div class="grid grid-cols-1 gap-4">
        <div>
          <label class="block text-sm font-medium text-[#001C48]"
            >x₀ (punto inicial)</label
          >
          <input
            [(ngModel)]="x0"
            class="w-full p-2 rounded bg-gray-100 text-[#001C48] border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA] focus:outline-none"
            type="number"
            step="any"
            placeholder="0"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-[#001C48]"
            >y₀ (valor inicial)</label
          >
          <input
            [(ngModel)]="y0"
            class="w-full p-2 rounded bg-gray-100 text-[#001C48] border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA] focus:outline-none"
            type="number"
            step="any"
            placeholder="1"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-[#001C48]"
            >h (tamaño del paso)</label
          >
          <input
            [(ngModel)]="h"
            class="w-full p-2 rounded bg-gray-100 text-[#001C48] border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA] focus:outline-none"
            type="number"
            step="any"
            placeholder="0.1"
          />
        </div>
        <div>
          <label class="block text-sm font-medium text-[#001C48]"
            >x final (punto objetivo)</label
          >
          <input
            [(ngModel)]="xFinal"
            class="w-full p-2 rounded bg-gray-100 text-[#001C48] border border-gray-300 focus:ring-2 focus:ring-[#3BAFDA] focus:outline-none"
            type="number"
            step="any"
            placeholder="1"
          />
        </div>
        <div class="flex gap-3">
          <button
            (click)="resolver()"
            class="inline-flex items-center gap-2 bg-gradient-to-b from-[#001C48] to-[#003366] text-white font-bold text-sm px-4 py-2 rounded-lg shadow-md hover:shadow-lg hover:from-[#003366] hover:to-[#004080] hover:-translate-y-0.5 transition"
          >
            Calcular
          </button>
          <button
            (click)="limpiar()"
            class="inline-flex items-center gap-2 bg-gray-100 text-[#001C48] font-semibold text-sm px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-200"
          >
            Limpiar
          </button>
          <button
            (click)="cargarEjemplo3()"
            class="inline-flex items-center gap-2 bg-gray-100 text-[#001C48] font-semibold text-sm px-4 py-2 rounded-lg border border-gray-300 hover:bg-gray-200"
          >
            Ejemplo 3
          </button>
        </div>
      </div>
    </section>

    <!-- Mensaje de resultado -->
    <section *ngIf="mensajeResultado">
      <div class="p-4 rounded-lg bg-green-50 border border-green-200">
        <p class="text-sm text-green-800">{{ mensajeResultado }}</p>
      </div>
    </section>

    <!-- Resultados -->
    <section class="space-y-4" *ngIf="resultados.length > 0">
      <h3 class="text-lg font-bold text-[#001C48]">Tabla de iteraciones</h3>

      <div class="overflow-x-auto rounded-xl border border-gray-200">
        <table class="w-full text-sm text-left text-[#001C48]">
          <thead
            class="text-xs bg-gray-100 border-b border-gray-200 sticky top-0"
          >
            <tr>
              <th class="px-4 py-3">i</th>
              <th class="px-4 py-3">x<sub>i</sub></th>
              <th class="px-4 py-3">y<sub>i</sub></th>
              <th class="px-4 py-3">
                k<sub>1</sub> = f(x<sub>i</sub>, y<sub>i</sub>)
              </th>
              <th class="px-4 py-3">
                k<sub>2</sub> = f(x<sub>i</sub>+h/2,
                y<sub>i</sub>+k<sub>1</sub>h/2)
              </th>
              <th class="px-4 py-3">
                y<sub>i+1</sub> = y<sub>i</sub> + k<sub>2</sub>·h
              </th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let r of resultadosPaginados; trackBy: trackByIndex"
              class="border-b hover:bg-gray-50"
            >
              <td class="px-4 py-3">{{ r.i }}</td>
              <td class="px-4 py-3">
                {{ r.xi | number : "1." + decimales + "-" + decimales }}
              </td>
              <td class="px-4 py-3">
                {{ r.yi | number : "1." + decimales + "-" + decimales }}
              </td>
              <td class="px-4 py-3">
                {{ r.k1 | number : "1." + decimales + "-" + decimales }}
              </td>
              <td class="px-4 py-3">
                {{ r.k2 | number : "1." + decimales + "-" + decimales }}
              </td>
              <td class="px-4 py-3 font-semibold">
                {{ r.yNext | number : "1." + decimales + "-" + decimales }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <div
        class="flex justify-center mt-2 flex-wrap gap-1"
        *ngIf="totalPaginas > 1"
      >
        <button
          *ngFor="let p of paginas"
          (click)="cambiarPagina(p)"
          [ngClass]="{
            'bg-[#003366] text-white': paginaActual === p,
            'bg-gray-100 text-gray-700': paginaActual !== p
          }"
          class="px-3 py-1 rounded hover:bg-gray-300"
        >
          {{ p }}
        </button>
      </div>
    </section>

    <!-- Información adicional -->
    <section class="p-4 rounded-lg bg-blue-50 border border-blue-200">
      <h3 class="text-md font-bold text-[#001C48] mb-2">ℹ️ Sobre el método</h3>
      <ul class="text-sm text-gray-700 space-y-1 list-disc list-inside">
        <li>
          El método de Runge-Kutta de segundo orden (punto medio) es más preciso
          que el método de Euler.
        </li>
        <li>
          Utiliza la pendiente en el punto medio del intervalo para mejorar la
          aproximación.
        </li>
        <li>
          Es útil para pronosticar el comportamiento futuro de sistemas
          dinámicos modelados por EDOs.
        </li>
        <li>
          Un paso h más pequeño aumenta la precisión pero requiere más
          iteraciones.
        </li>
      </ul>
    </section>
  </div>
</div>
